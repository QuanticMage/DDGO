@* ViewBar.razor *@

<div class="viewbar" role="region" aria-label="View options">
 
    <div class="viewbar-selections">
        <button type="button"
                class="vb-toggle @(CensorUltPlusPlus ? "on" : "off")"
                aria-pressed="@CensorUltPlusPlus"
                title="Replace the last character of Ult+/Ult++ for screenshot safety"
                @onclick="ToggleCensor">
            <span class="vb-dot" aria-hidden="true"></span>
            <span class="vb-label">Censor Ult++</span>
        </button>

        <button type="button"
                class="vb-toggle @(HighlightBest ? "on" : "off")"
                aria-pressed="@HighlightBest"
                title="Highlight rows that are best for the current rating mode"
                @onclick="ToggleHighlight">
            <span class="vb-dot" aria-hidden="true"></span>
            <span class="vb-label">Highlight Best</span>
        </button>

        <VbSelectMenu T="UiLayoutSize"
                    Label="Itembox size"
                    AriaLabel="Select layout size"
                    MenuAriaLabel="Itembox size"
                    Items="@_layoutItems"
                    Value="@Layout"
                    ValueChanged="@OnLayoutChanged">                 
        </VbSelectMenu>

    </div>
</div>

@code {
    public enum UiLayoutSize
    {
        ThreeByFive,
        FourByFive,
        FourBySix
    }
    
    [Parameter] public string? HintText { get; set; } =
        "Click names to sort, or stars to adjust the rating calculation →";

    // placeholders for now (wire later)
    [Parameter] public bool CensorUltPlusPlus { get; set; } = true;
    [Parameter] public bool HighlightBest { get; set; } = true;
    [Parameter] public UiLayoutSize Layout { get; set; } = UiLayoutSize.ThreeByFive;

    // optional callbacks for later
    [Parameter] public EventCallback<bool> CensorUltPlusPlusChanged { get; set; }
    [Parameter] public EventCallback<bool> HighlightBestChanged { get; set; }
    [Parameter] public EventCallback<UiLayoutSize> LayoutChanged { get; set; }
    [Parameter] public EventCallback SettingsClicked { get; set; }

    private readonly IReadOnlyList<VbSelectMenu<UiLayoutSize>.Item> _layoutItems =
        new List<VbSelectMenu<UiLayoutSize>.Item>
        {
            new(UiLayoutSize.ThreeByFive, "3×5", ""),
            new(UiLayoutSize.FourByFive,  "4×5", ""),
            new(UiLayoutSize.FourBySix,   "4×6", ""),
        };


    private async Task ToggleCensor()
    {
        CensorUltPlusPlus = !CensorUltPlusPlus;
        if (CensorUltPlusPlusChanged.HasDelegate)
            await CensorUltPlusPlusChanged.InvokeAsync(CensorUltPlusPlus);
    }

    private async Task ToggleHighlight()
    {
        HighlightBest = !HighlightBest;
        if (HighlightBestChanged.HasDelegate)
            await HighlightBestChanged.InvokeAsync(HighlightBest);
    }

    private async Task OnLayoutChanged(UiLayoutSize v)
    {
        Layout = v;
        if (LayoutChanged.HasDelegate)
            await LayoutChanged.InvokeAsync(v);
    }

    private async Task OpenSettings()
    {
        if (SettingsClicked.HasDelegate)
            await SettingsClicked.InvokeAsync();
    }
}
